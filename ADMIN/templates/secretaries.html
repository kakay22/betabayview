{% extends 'admin_panel.html' %}
{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ user }} / {% block title %} Secretaries {% endblock title %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
</head>

<body class="bg-gray-100">
    {% block content %}
    <style>
        #pop-up-mess {
            z-index: 99999999;
            top: -100%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: pop 3.5s ease;
        }

        @keyframes pop {
            20% {
                top: 10%;
            }

            50% {
                top: 10%;
            }

            70% {
                top: 10%;
            }

            80% {
                top: 10%;
            }

            90% {
                top: 10%;
            }

            100% {
                display: none;
            }
        }
    </style>
    <link rel="stylesheet" href="{% static 'css/admin-pop-up-mess.css' %}">

    <!--Content container-->
    <div
        class="w-full md:w-[85%] max-[770px]:h-full h-[90%] mt-[.8rem] bg-white absolute right-0 top-[4rem] md:top-[3.8rem] shadow-md rounded-md py-4 md:px-3 overflow-y-auto overflow-x-hidden">

        <!-- Loading Spinner (hidden until request is sent) -->
        <div id="loadingSpinner" class="fixed inset-0 flex flex-col items-center justify-center bg-gray-800 bg-opacity-50 hidden z-[999999999999]">
            <div class="spinner-border text-primary" role="status">
            </div>
            <span class="">Loading...</span>
        </div>

        <!--Back-->
        <div class="flex mb-4 items-center md:px-0 px-3">
			<a onclick="history.back()"
				class="bi bi-arrow-left mr-2 text-[1.2rem] px-[.8rem] flex items-center py-[.7rem] rounded-full hover:bg-gray-200 cursor-pointer">
			</a>
			<h1 class="text-xl font-medium">Secretaries</h1>
		</div>

        <!-- Search input -->
        <div class="mb-2 flex gap-2 items-center px-3 md:px-0">
            <i data-bs-toggle="modal" data-bs-target="#addNewSec"
                class="btn btn-primary shadow-gray-500 shadow-md max-[770px]:rounded-full"><i
                    class="bi bi-plus font-semibold"></i> <span class="hidden min-[770px]:inline"></span></i>
            <div class="form-control flex items-center">
                <i class="bi bi-search text-[1rem] px-2"></i>
                <input type="text" id="searchInput" class="border-none py-1 pl-2 w-full outline-none" placeholder="Search for secretaries...">
            </div>                    
            <i id="filterBtn"
                class="bi bi-filter cursor-pointer hover:bg-gray-200 text-[1.5rem] px-2 bg-gray-100 shadow-md"></i>
            <!-- Button trigger for delete all secretary modal -->
            <i class="bi bi-trash cursor-pointer hover:bg-gray-200 text-[1.5rem] px-2 bg-gray-100 shadow-md"
                data-bs-toggle="modal" data-bs-target="#exampleModal"></i>
        </div>

        <!-- Modal FOR DELETE SECRETARY ALL-->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="w-full p-3 text-right mb-0">
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="w-full">
                        <div class="w-full text-center">
                            <i class="bi bi-exclamation-circle text-[5rem] text-orange-500"></i>
                        </div>
                        {% if Secretaries.count == 0 %}
                        <h1 class="w-full text-center">No secretaries to delete</h1>
                        {% else %}
                        <h1 class="w-full text-center">Are you sure you wan't to delete all secretaries?</h1>
                        {% endif %}
                    </div>

                    {% if Secretaries.count == 0 %}
                    <div class="w-full text-center p-3">
                        <button type="button"
                            class="border border-gray-700 hover:border-2 py-2 rounded-md bg-transparent text-gray-700 w-[40%]"
                            data-bs-dismiss="modal">OK</button>
                    </div>
                    {% else %}
                    <div class="w-full text-center p-3">
                        <form action="{% url 'delete_all_secretaries' %}" method="post">
                            {% csrf_token %}
                            <button type="button"
                                class="border border-gray-700 hover:border-2 py-[.4rem] rounded-md bg-transparent text-gray-700 w-[40%]"
                                data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary w-[40%]">Delete
                                all</button>
                        </form>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        <!--End modal for delete all secretary-->

        <!-- Modal FOR ADD NEW SECRETARY-->
        <div class="modal fade" id="addNewSec" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog mt-0">
                <div class="modal-content mt-0">
                    <div class="w-full p-3 text-right mb-0">
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <div class="w-full text-center p-3">
                        <h1 class="text-lg font-semibold">Add new secretary</h1>
                    </div>

                    <form id="secretary-form" class="w-full p-3" method="post" action="{% url 'new_secretary' %}">
                        {% csrf_token %}
                        <fieldset class="px-4 mb-2">
                            <div class="text-red-500 text-sm error-message"></div>
                            <!-- Error message will be inserted here -->
                            <div class="mb-2">
                                <label for="firstname" class="form-label">Firstname</label>
                                {{ form.first_name }}
                                {% for error in form.first_name.errors %}
                                <div class="text-red-500 text-sm">{{ error }}</div>
                                {% endfor %}
                            </div>

                            <div class="mb-2">
                                <label for="lastname" class="form-label">Lastname</label>
                                {{ form.last_name }}
                                {% for error in form.last_name.errors %}
                                <div class="text-red-500 text-sm">{{ error }}</div>
                                {% endfor %}
                            </div>

                            <div class="mb-2">
                                <label for="date_of_birth" class="form-label">Date of birth</label>
                                {{ form.date_of_birth }}
                                {% for error in form.date_of_birth.errors %}
                                <div class="text-red-500 text-sm">{{ error }}</div>
                                {% endfor %}
                            </div>

                            <div class="mb-2">
                                <label for="date_of_birth" class="form-label">Age</label>
                                {{ form.age }}
                                {% for error in form.age.errors %}
                                <div class="text-red-500 text-sm">{{ error }}</div>
                                {% endfor %}
                            </div>

                            <div class="mb-2">
                                <label for="gender" class="form-label">Gender</label>
                                {{ form.gender }}
                                {% for error in form.gender.errors %}
                                <div class="text-red-500 text-sm">{{ error }}</div>
                                {% endfor %}
                            </div>

                            <div class="mb-2">
                                <label for="contact_number" class="form-label">Contact number</label>
                                {{ form.contact_number }}
                                {% for error in form.contact_number.errors %}
                                <div class="text-red-500 text-sm">{{ error }}</div>
                                {% endfor %}
                            </div>

                            <div class="mb-2">
                                <label for="email_address" class="form-label">Email address</label>
                                {{ form.email_address }}
                                {% for error in form.email_address.errors %}
                                <div class="text-red-500 text-sm">{{ error }}</div>
                                {% endfor %}
                            </div>
                        </fieldset>

                        <hr class="mb-2">

                        <fieldset class="px-3 mb-2">
                            <div class="mb-2">
                                <label for="name_of_emergency_contact" class="form-label">Name of emergency
                                    contact</label>
                                {{ form.name_of_emergency_contact }}
                                {% for error in form.name_of_emergency_contact.errors %}
                                <div class="text-red-500 text-sm">{{ error }}</div>
                                {% endfor %}
                            </div>

                            <div class="mb-2">
                                <label for="relationship_to_secretary" class="form-label">Relationship to
                                    secretary</label>
                                {{ form.relationship_to_secretary }}
                                {% for error in form.relationship_to_secretary.errors %}
                                <div class="text-red-500 text-sm">{{ error }}</div>
                                {% endfor %}
                            </div>

                            <div class="mb-2">
                                <label for="emergency_contact_number" class="form-label">Emergency contact
                                    number</label>
                                {{ form.emergency_contact_number }}
                                {% for error in form.emergency_contact_number.errors %}
                                <div class="text-red-500 text-sm">{{ error }}</div>
                                {% endfor %}
                            </div>
                        </fieldset>

                        <hr class="mb-2">

                        <fieldset class="px-3 mb-2">
                            <div class="mb-2">
                                <label for="highest_educational_attainment" class="form-label">Highest education
                                    attainment</label>
                                {{ form.highest_educational_attainment }}
                                {% for error in form.highest_educational_attainment.errors %}
                                <div class="text-red-500 text-sm">{{ error }}</div>
                                {% endfor %}
                            </div>
                        </fieldset>

                        <hr class="mb-2">

                        <fieldset class="px-3 mb-2">
                            <div class="mb-2">
                                <label for="user_name" class="form-label">Username</label>
                                {{ form.user_name }}
                                {% for error in form.user_name.errors %}
                                <div class="text-red-500 text-sm">{{ error }}</div>
                                {% endfor %}
                            </div>
                            <div class="mb-2">
                                <label for="password" class="form-label">Password</label>
                                {{ form.password }}
                                {% for error in form.password.errors %}
                                <div class="text-red-500 text-sm">{{ error }}</div>
                                {% endfor %}
                            </div>
                        </fieldset>

                        <hr class="mb-2">

                        <div class="w-full">
                            <button type="submit" class="btn btn-primary w-full">Submit</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!--End modal for add new secretary-->

        <!-- Filters -->
        <div id="filterContainer"
            class="mb-2 h-full shadow-md shadow-gray-600 bg-white absolute right-[-100%] top-0 w-[25%] max-[770px]:w-[50%] z-[999] px-3 overflow-y-scroll">
            <h1 class="w-full py-2 text-[1.5rem] justify-between flex items-center ">Filtration <i id="filterCloseBtn"
                    class="bi bi-x absolute right-3 cursor-pointer"></i></h1>
            <div>
                <label for="genderFilter" class="form-label">Gender</label>
                <select id="genderFilter" class="form-select">
                    <option value="">All</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                </select>
            </div>
            <div>
                <label for="educationFilter" class="form-label">Highest Education</label>
                <select id="educationFilter" class="form-select">
                    <option value="">All</option>
                    <option value="elementary">Elementary</option>
                    <option value="highschool">Highschool</option>
                    <option value="college">College</option>
                </select>
            </div>
        </div>

        {% for message in messages %}
            <p id="pop-up-mess"
                class="alert py-2 absolute border-none bg-white shadow-md shadow-gray-400 text-black">
                {% if message.tags == 'error' %}
                    <i class="bi bi-x-circle-fill text-red-600"></i> {{ message }}
                {% elif message.tags == 'success' %}
                    <i class="bi bi-check-circle-fill text-green-600"></i> {{ message }}
                {% else %}
                    <i class="bi bi-info-circle-fill text-blue-600"></i> {{ message }}
                {% endif %}
            </p>
        {% endfor %}

        <div class="overflow-x-auto max-h-[75vh] overflow-y-auto">
            <table id="myTable" class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-100 sticky top-0 z-10">
                    <tr>
                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Image</th>
                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Firstname</th>
                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Lastname</th>
                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Date
                            of birth</th>
                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Age
                        </th>
                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Gender</th>
                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Contact no</th>
                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Email
                            address</th>
                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Name
                            of emergency contact</th>
                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Relation to secretary</th>
                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Emergency contact no</th>
                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Highest educational attainment</th>
                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Username</th>
                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Action</th>
                    </tr>
                </thead>
                <tbody id="secretariesTable" class="bg-white divide-y divide-gray-200">
                    {% for sec in page_obj %}
                    <tr>
                        <td class="px-4 py-2 whitespace-nowrap"><img src="{{ sec.profile_picture.url }}"
                                class="w-10 h-10 rounded-full object-cover shadow-md shadow-gray-400"
                                alt="secretary profile" srcset=""></td>
                        <td class="px-4 py-2 whitespace-nowrap">{{ sec.first_name }}</td>
                        <td class="px-4 py-2 whitespace-nowrap">{{ sec.last_name }}</td>
                        <td class="px-4 py-2 whitespace-nowrap">{{ sec.date_of_birth }}</td>
                        <td class="px-4 py-2 whitespace-nowrap">{{ sec.age }}</td>
                        <td class="px-4 py-2 whitespace-nowrap">{{ sec.gender }}</td>
                        <td class="px-4 py-2 whitespace-nowrap">{{ sec.contact_number }}</td>
                        <td class="px-4 py-2 whitespace-nowrap">{{ sec.user.email }}</td>
                        <td class="px-4 py-2 truncate max-w-[200px]">{{ sec.name_of_emergency_contact }}</td>
                        <td class="px-4 py-2 whitespace-nowrap">{{ sec.relationship_to_secretary }}</td>
                        <td class="px-4 py-2 truncate max-w-[200px]">{{ sec.emergency_contact_number }}</td>
                        <td class="px-4 py-2 whitespace-nowrap">{{ sec.highest_educational_attainment }}</td>
                        <td class="px-4 py-2 whitespace-nowrap">{{ sec.user.username }}</td>
                        <td class="px-4 py-2 whitespace-nowrap">
                            <!--ellipsis-->
                            <button class="w-full hover:bg-gray-200 rounded-full py-2" data-bs-toggle="dropdown"
                                aria-expanded="false"><i class="bi bi-three-dots"></i></button>
                            <ul class="dropdown-menu">

                                <!--view button for modal-->
                                <li>
                                    <button type="button" class="dropdown-item text-blue-500" data-bs-toggle="modal"
                                        data-bs-target="#viewModal{{ sec.pk}}">
                                        <i class="bi bi-eye-fill"></i> VIEW
                                    </button>
                                </li>

                                <!--edit button for modal-->
                                <li>
                                    <button type="button" class="dropdown-item text-green-500" data-bs-toggle="modal"
                                        data-bs-target="#editModal{{ sec.pk}}">
                                        <i class="bi bi-pen-fill"></i> UPDATE
                                    </button>
                                </li>


                                <!--delete button for modal-->
                                <li>
                                    <button type="button" class="dropdown-item text-red-500" data-bs-toggle="modal"
                                        data-bs-target="#deleteModal{{ sec.pk}}">
                                        <i class="bi bi-trash-fill"></i> DELETE
                                    </button>
                                </li>
                            </ul>

                            <!-- View Modal -->
                            <div class="modal fade" id="viewModal{{ sec.pk }}" tabindex="-1" aria-labelledby="viewModalLabel{{ sec.pk }}" aria-hidden="true">
                                <div class="modal-dialog modal-md">
                                    <div class="modal-content rounded-xl shadow-lg border-0">
                                        <!-- Modal Header -->
                                        <div class="modal-header bg-gray-100 border-0 p-4 flex justify-between items-center">
                                            <h5 class="modal-title font-semibold text-lg text-gray-800" id="viewModalLabel{{ sec.pk }}">
                                                <i class="bi bi-person-circle me-2"></i> View {{ sec.first_name|title }}
                                            </h5>
                                            <button type="button" class="btn-close bg-gray-300 hover:bg-gray-400 rounded-full p-2" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>

                                        <!-- Modal Body -->
                                        <div class="modal-body">
                                            <!-- Profile Section -->
                                            <div class="flex flex-col items-center justify-center py-6">
                                                <img src="{{ sec.profile_picture.url }}" class="h-[8rem] w-[8rem] rounded-full shadow-lg border-4 border-gray-200" alt="Secretary Profile Picture">
                                                <h2 class="text-xl font-bold text-gray-800 mt-4">{{ sec.first_name|title }} {{ sec.last_name|title }}</h2>
                                                <p class="text-gray-600">Age: {{ sec.age }} | Gender: {{ sec.gender }}</p>
                                            </div>

                                            <!-- User Info Table with Icons -->
                                            <div class="overflow-y-auto max-h-[400px]">
                                                <table class="w-full text-left text-sm text-gray-700">
                                                    <tbody>
                                                        <tr class="border-b">
                                                            <th class="py-3 px-4 flex items-center text-gray-500 font-medium">
                                                                <i class="bi bi-person-fill mr-2 text-blue-500"></i> First Name
                                                            </th>
                                                            <td class="py-3 px-4">{{ sec.first_name }}</td>
                                                        </tr>
                                                        <tr class="border-b">
                                                            <th class="py-3 px-4 flex items-center text-gray-500 font-medium">
                                                                <i class="bi bi-person-fill mr-2 text-blue-500"></i> Last Name
                                                            </th>
                                                            <td class="py-3 px-4">{{ sec.last_name }}</td>
                                                        </tr>
                                                        <tr class="border-b">
                                                            <th class="py-3 px-4 flex items-center text-gray-500 font-medium">
                                                                <i class="bi bi-calendar-fill mr-2 text-blue-500"></i> Date of Birth
                                                            </th>
                                                            <td class="py-3 px-4">{{ sec.date_of_birth }}</td>
                                                        </tr>
                                                        <tr class="border-b">
                                                            <th class="py-3 px-4 flex items-center text-gray-500 font-medium">
                                                                <i class="bi bi-people-fill mr-2 text-blue-500"></i> Age
                                                            </th>
                                                            <td class="py-3 px-4">{{ sec.age }}</td>
                                                        </tr>
                                                        <tr class="border-b">
                                                            <th class="py-3 px-4 flex items-center text-gray-500 font-medium">
                                                                <i class="bi bi-gender-ambiguous mr-2 text-blue-500"></i> Gender
                                                            </th>
                                                            <td class="py-3 px-4">{{ sec.gender }}</td>
                                                        </tr>
                                                        <tr class="border-b">
                                                            <th class="py-3 px-4 flex items-center text-gray-500 font-medium">
                                                                <i class="bi bi-envelope-fill mr-2 text-blue-500"></i> Email Address
                                                            </th>
                                                            <td class="py-3 px-4">{{ sec.user.email }}</td>
                                                        </tr>
                                                        <tr class="border-b">
                                                            <th class="py-3 px-4 flex items-center text-gray-500 font-medium">
                                                                <i class="bi bi-telephone-fill mr-2 text-blue-500"></i> Contact No
                                                            </th>
                                                            <td class="py-3 px-4">{{ sec.contact_number }}</td>
                                                        </tr>
                                                        <tr class="border-b">
                                                            <th class="py-3 px-4 flex items-center text-gray-500 font-medium">
                                                                <i class="bi bi-person-lines-fill mr-2 text-blue-500"></i> Emergency Contact
                                                            </th>
                                                            <td class="py-3 px-4">{{ sec.name_of_emergency_contact }}</td>
                                                        </tr>
                                                        <tr class="border-b">
                                                            <th class="py-3 px-4 flex items-center text-gray-500 font-medium">
                                                                <i class="bi bi-award-fill mr-2 text-blue-500"></i> Highest Education Attainment
                                                            </th>
                                                            <td class="py-3 px-4">{{ sec.highest_educational_attainment }}</td>
                                                        </tr>
                                                        <tr class="border-b">
                                                            <th class="py-3 px-4 flex items-center text-gray-500 font-medium">
                                                                <i class="bi bi-person-fill mr-2 text-blue-500"></i> Username
                                                            </th>
                                                            <td class="py-3 px-4">{{ sec.user.username }}</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- Modal Footer -->
                                        <div class="modal-footer bg-gray-100 border-0 py-4">
                                            <button type="button" class="btn btn-primary rounded-full py-2 px-4" data-bs-dismiss="modal">
                                                <i class="bi bi-x-circle me-1"></i> Close
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- End modal for view -->

                            <!-- Modal for Edit -->
                            <div class="modal fade" id="editModal{{ sec.pk }}" tabindex="-1" aria-labelledby="editModalLabel{{ sec.pk }}" aria-hidden="true">
                                <div class="modal-dialog modal-md">
                                    <div class="modal-content rounded-lg shadow-lg">
                                        <div class="modal-header border-b-2 border-gray-300">
                                            <h5 class="modal-title text-2xl font-semibold" id="editModalLabel{{ sec.pk }}">
                                                <i class="bi bi-pencil-square me-2"></i> Edit {{ sec.user_name }}
                                            </h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <!-- Profile picture -->
                                        <div class="w-full flex justify-center py-3">
                                            <img src="{{ sec.profile_picture.url }}" class="h-32 w-32 rounded-full shadow-lg border-4 border-gray-200" alt="Secretary Picture">
                                        </div>
                                        <div class="modal-body">
                                            <!-- Edit Form -->
                                            <form method="post" action="{% url 'edit_secretary' sec.pk %}">
                                                {% csrf_token %}
                                                <div class="mb-3">
                                                    <label for="first_name" class="form-label">
                                                        <i class="bi bi-person me-2"></i>Firstname
                                                    </label>
                                                    <input type="text" class="form-control" name="first_name" id="first_name" value="{{ sec.first_name }}" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="last_name" class="form-label">
                                                        <i class="bi bi-person-lines-fill me-2"></i>Lastname
                                                    </label>
                                                    <input type="text" class="form-control" name="last_name" id="last_name" value="{{ sec.last_name }}" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="contact_number" class="form-label">
                                                        <i class="bi bi-telephone-fill me-2"></i>Contact No
                                                    </label>
                                                    <input type="text" class="form-control" name="contact_number" id="contact_number" value="{{ sec.contact_number }}" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="email_address" class="form-label">
                                                        <i class="bi bi-envelope-fill me-2"></i>Email Address
                                                    </label>
                                                    <input type="email" class="form-control" name="email_address" id="email_address" value="{{ sec.user.email }}" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="username" class="form-label">
                                                        <i class="bi bi-person-circle me-2"></i>Username
                                                    </label>
                                                    <input type="text" class="form-control" name="user_name" id="username" value="{{ sec.user.username }}" required>
                                                </div>
                                                <div class="modal-footer border-t-2 border-gray-300">
                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                                        <i class="bi bi-x-circle me-1"></i> Close
                                                    </button>
                                                    <button type="submit" class="btn btn-primary">
                                                        <i class="bi bi-save me-1"></i> Save Changes
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- End modal for Edit -->

                            <!-- Modal for Delete -->
                            <div class="modal fade" id="deleteModal{{ sec.pk }}" tabindex="-1" aria-labelledby="deleteModalLabel{{ sec.pk }}" aria-hidden="true">
                                <div class="modal-dialog modal-md">
                                    <div class="modal-content rounded-lg shadow-lg">
                                        <div class="modal-header border-b-2 border-gray-300">
                                            <h5 class="modal-title w-full text-center text-2xl font-semibold" id="deleteModalLabel{{ sec.pk }}">
                                                <i class="bi bi-trash-fill me-2 text-red-500"></i> Delete {{ sec.first_name }}?
                                            </h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body text-center">
                                            <h1 class="text-[5rem] text-red-500">
                                                <i class="bi bi-x-circle"></i>
                                            </h1>
                                            <p class="text-lg">Are you sure you want to delete Secretary "{{ sec.first_name }}"?</p>
                                        </div>
                                        <div class="modal-footer border-t-2 border-gray-300">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                                <i class="bi bi-x-circle me-1"></i> Cancel
                                            </button>
                                            <form action="{% url 'delete_secretary' sec.pk %}" method="post">
                                                {% csrf_token %}
                                                <button type="submit" class="btn btn-danger">
                                                    <i class="bi bi-trash-fill me-1"></i> Delete
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- END modal for Delete -->
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="12" class="px-4 py-2 text-center text-gray-500">No secretaries found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <div class="text-[#6c757d] hidden w-full text-center text-[1.25rem] mt-[1.5rem]" id="noResultsFound">
                <i class="bi bi-search text-[2.5rem]"></i>
                <p>No results found.</p>
            </div>
        </div>
        <!--pagination-->
        <div class="py-2 px-3 md:px-0">
            <nav class="block">
                <ul class="pagination">
                    {% if page_obj.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page=1" aria-label="First">
                            <span aria-hidden="true">&laquo;&laquo;</span>
                        </a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                    {% endif %}

                    {% for num in page_obj.paginator.page_range %}
                    {% if page_obj.number == num %}
                    <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                    {% elif num > page_obj.number|add:-3 and num < page_obj.number|add:3 %} <li class="page-item"><a
                            class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                        {% endif %}
                        {% endfor %}

                        {% if page_obj.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}" aria-label="Last">
                                <span aria-hidden="true">&raquo;&raquo;</span>
                            </a>
                        </li>
                        {% endif %}
                </ul>
            </nav>
        </div>
    </div>
    {% endblock content %}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    {% block extra_js %}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="{% static 'js/inputFilter.js' %}"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('#secretary-form').submit(function (e) {
                e.preventDefault(); // Prevent default form submission

                // Clear previous error messages
                $('.error-message').remove();

                $.ajax({
                    url: '{% url "new_secretary" %}',  // Update with your URL pattern name
                    type: 'POST',
                    data: $(this).serialize(),  // Serialize form data
                    success: function (response) {
                        if (response.success) {
                            // Redirect after success
                            window.location.href = '/secretaries/?message=Secretary%20created%20successfully';
                        }
                    },
                    error: function (xhr, status, error) {
                        var errors = xhr.responseJSON.errors || {};

                        // Display errors under the form fields
                        $.each(errors, function (field, errorMessages) {
                            let fieldElement = $('[name=' + field + ']');  // Select form input by name
                            let errorHtml = '<div class="error-message text-red-500 text-sm mt-1">' + errorMessages.join('<br>') + '</div>';
                            fieldElement.after(errorHtml);  // Insert error message after input
                        });
                    }
                });
            });
        });

            // var searchInput = document.getElementById('searchInput');
            // var genderFilter = document.getElementById('genderFilter');
            // var educationFilter = document.getElementById('educationFilter');

            // var secretariesTable = document.getElementById('secretariesTable');

            // // Highlight search text in table cells
            // function highlight(text) {
            //     if (!text) return;
            //     const regex = new RegExp(`(${text})`, 'gi');
            //     rows.forEach(function (row) {
            //         row.querySelectorAll('td').forEach(function (td) {
            //             td.innerHTML = td.innerText.replace(regex, function (match) {
            //                 return "<span class='bg-yellow-200'>" + match + "</span>";
            //             });
            //         });
            //     });
            // }

            // function filterTable() {
            //     var filterValue = searchInput.value.toLowerCase();
            //     var genderValue = genderFilter.value.toLowerCase();
            //     var educationValue = educationFilter.value.toLowerCase();

            //     var rows = secretariesTable.getElementsByTagName('tr');
            //     var noResults = true;

            //     for (var i = 0; i < rows.length; i++) {
            //         var cells = rows[i].getElementsByTagName('td');

            //         if (cells.length > 0) {
            //             var rowText = rows[i].textContent.toLowerCase();
            //             var firstname = cells[1] ? cells[1].textContent.toLowerCase() : '';
            //             var lastname = cells[2] ? cells[2].textContent.toLowerCase() : '';
            //             var dateOfBirth = cells[3] ? cells[3].textContent.toLowerCase() : '';
            //             var age = cells[4] ? cells[4].textContent.toLowerCase() : '';
            //             var gender = cells[5] ? cells[5].textContent.toLowerCase() : '';
            //             var contactNumber = cells[6] ? cells[6].textContent.toLowerCase() : '';
            //             var email = cells[7] ? cells[7].textContent.toLowerCase() : '';
            //             var education = cells[11] ? cells[11].textContent.toLowerCase() : '';
            //             var username = cells[12] ? cells[12].textContent.toLowerCase() : '';
            //             var matchesFilter = rowText.includes(filterValue) &&
            //                 (genderValue === '' || gender === genderValue) &&
            //                 (educationValue === '' || education === educationValue);

            //             if (matchesFilter) {
            //                 rows[i].style.display = '';
            //                 noResults = false;
            //             } else {
            //                 rows[i].style.display = 'none';
            //             }
            //         }
            //     }
            // }

        // //     // Add event listeners
        // //     searchInput.addEventListener('input', filterTable);
        // //     genderFilter.addEventListener('change', filterTable);
        // //     educationFilter.addEventListener('change', filterTable);

        // //     // Initial filter on page load
        // //     filterTable();
        // // });

        // // For opening filtration
        // const filterContainer = document.querySelector('#filterContainer');
        // const filterBtn = document.querySelector("#filterBtn");
        // filterBtn.addEventListener('click', (e) => {
        //     filterContainer.style.transition = '.4s linear';
        //     filterContainer.style.right = '0';
        // });

        // function closeFilter() {
        //     filterContainer.style.transition = '.4s linear';
        //     filterContainer.style.right = '-100%';
        // }

        // document.addEventListener('click', (e) => {
        //     if (!filterContainer.contains(e.target) && !filterBtn.contains(e.target)) {
        //         closeFilter();
        //     }
        // });

        // const filterCloseBtn = document.querySelector("#filterCloseBtn").addEventListener('click', (e) => {
        //     closeFilter();
        // });

        //hide preloader
        // window.addEventListener('load', (e) => {
        //     var preloader = document.getElementById('pre-loader')
        //     preloader.style.display = 'none'
        // })

        //fetch unread notification
		function fetchUnreadCount() {
        fetch("{% url 'admin_unread_notifications_count' %}")
            .then(response => response.json())
            .then(data => {
                    const notificationCount = data.unread_count;
                    const notificationBadge = document.querySelector('.notification-badge');
                    if (notificationCount > 0) {
                        notificationBadge.textContent = notificationCount;
                        notificationBadge.classList.remove('hidden'); // Show badge
                    } else {
                        notificationBadge.classList.add('hidden'); // Hide badge
                    }
                });
        }
        // Call this function to check unread notifications every .5 second
        setInterval(fetchUnreadCount, 500);
        fetchUnreadCount();  // Initial call to set the count immediately
    </script>

    {% endblock extra_js %}
</body>

</html>